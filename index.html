<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ø­Ù„Ù‚Ø© Ø§Ù„Ù…Ù„Ùƒ ÙÙ‡Ø¯</title>

<style>
:root{
  --bg:#0f172a;
  --bg2:#020617;
  --card:#111827;
  --accent:#38bdf8;
  --accent2:#0ea5e9;
  --text:#e5e7eb;
  --muted:#9ca3af;
  --good:#4ade80;
  --mid:#facc15;
  --bad:#f97373;
}
*{box-sizing:border-box;}
body{
  margin:0;
  font-family:"Segoe UI","Tahoma",sans-serif;
  background:radial-gradient(circle at top,#1f2937,#020617);
  color:var(--text);
}

/* Ø§Ù„ØµÙØ­Ø§Øª */
.page{display:none;min-height:100vh;}
.page.active{display:block;}

/* Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ */
.login-wrapper{
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:20px;
}
.login-card{
  background:var(--card);
  padding:20px 18px;
  border-radius:16px;
  max-width:360px;
  width:100%;
  box-shadow:0 18px 40px rgba(0,0,0,.6);
  border:1px solid #1f2937;
  text-align:center;
}
.login-card h1{margin:0 0 8px;font-size:1.4rem;}
.login-card p{margin:0 0 12px;font-size:.9rem;color:var(--muted);}
.login-input{
  width:100%;
  padding:10px;
  border-radius:8px;
  border:1px solid #1f2937;
  background:#020617;
  color:#fff;
  margin-bottom:10px;
}
.btn{
  border:none;
  cursor:pointer;
  border-radius:999px;
  padding:8px 16px;
  font-size:.9rem;
  font-weight:600;
  transition:.15s;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:6px;
}
.btn-primary{
  background:linear-gradient(135deg,#0ea5e9,#38bdf8);
  color:#020617;
}
.btn-secondary{
  background:#020617;
  color:var(--muted);
  border:1px solid #1f2937;
}
.btn:hover{transform:translateY(-1px);}
.login-error{
  color:var(--bad);
  font-size:.8rem;
  min-height:1em;
}

/* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø¹Ø§Ù… */
.app-header{
  padding:14px 18px;
  background:#020617;
  border-bottom:1px solid #1f2937;
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:10px;
}
.app-header h2{margin:0;font-size:1.3rem;}
.badge{
  padding:4px 10px;
  border-radius:999px;
  background:#0f172a;
  font-size:.8rem;
  color:var(--muted);
}

/* Ø´Ø±ÙŠØ· Ø£Ø¹Ù„Ù‰ (B: ÙŠÙ…ÙŠÙ† Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹/Ø§Ù„ÙŠÙˆÙ… â€“ ÙŠØ³Ø§Ø± Ø§Ù„Ø£Ø²Ø±Ø§Ø±) */
.top-controls{
  padding:12px 16px;
  background:rgba(15,23,42,0.9);
  border-bottom:1px solid #111827;
  display:flex;
  justify-content:space-between;
  align-items:center;
  flex-wrap:nowrap;
}
.top-left,
.top-right{
  display:flex;
  align-items:center;
  gap:10px;
  flex-wrap:wrap;
}
.select-pill{
  display:flex;
  align-items:center;
  gap:6px;
  padding:6px 10px;
  border-radius:999px;
  background:#020617;
  border:1px solid #1f2937;
  font-size:.8rem;
}
.select-pill label{color:var(--muted);}
.select-pill select{
  border:none;
  background:transparent;
  color:var(--text);
  font-size:.85rem;
  outline:none;
}

/* Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø¹Ù„Ù… */
.app-main{
  padding:16px;
}

/* Ø¨Ø·Ø§Ù‚Ø© Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© */
.settings-card{
  max-width:1100px;
  margin:0 auto 16px;
  background:#0f172a;
  border-radius:16px;
  padding:12px 14px;
  border:1px solid #1f2937;
}
.settings-group{
  display:flex;
  flex-wrap:wrap;
  align-items:center;
  gap:6px;
  font-size:.85rem;
  margin-bottom:6px;
}
.settings-group span{color:var(--muted);}
.settings-group select{
  border-radius:999px;
  border:1px solid #1f2937;
  padding:4px 10px;
  background:#020617;
  color:#e5e7eb;
  font-size:.85rem;
  outline:none;
}

/* Ù„ÙˆØ­Ø© Ø§Ù„Ø´Ø±Ù */
.honor-card{
  max-width:1100px;
  margin:0 auto 16px;
  background:#0f172a;
  border-radius:16px;
  padding:12px 14px;
  border:1px solid #1f2937;
}
.honor-list{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  margin-top:6px;
}
.honor-item{
  background:#020617;
  border-radius:999px;
  padding:6px 10px;
  border:1px solid #1f2937;
  font-size:.8rem;
  display:flex;
  gap:6px;
  align-items:center;
}
.honor-rank{font-weight:700;}
.honor-name{}

/* Ø´Ø¨ÙƒØ© Ø§Ù„Ø·Ù„Ø§Ø¨ */
.students-grid{
  max-width:1100px;
  margin:0 auto;
  display:grid;
  gap:12px;
}
@media(min-width:700px){
  .students-grid{grid-template-columns:repeat(2,minmax(0,1fr));}
}
@media(min-width:1050px){
  .students-grid{grid-template-columns:repeat(3,minmax(0,1fr));}
}

/* ÙƒØ±Øª Ø§Ù„Ø·Ø§Ù„Ø¨ */
.student-card{
  background:#0f172a;
  border-radius:16px;
  padding:10px 12px 12px;
  border:1px solid #111827;
  box-shadow:0 12px 30px rgba(0,0,0,0.6);
}
.student-card.absent{opacity:.35;}

.card-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:8px;
}
.card-header-left{
  display:flex;
  align-items:center;
  gap:8px;
}
.avatar{
  width:28px;
  height:28px;
  border-radius:999px;
  background:linear-gradient(135deg,#38bdf8,#0ea5e9);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:.75rem;
  font-weight:700;
  color:#020617;
}
.name{font-size:.9rem;font-weight:600;}
.card-tag{
  font-size:.7rem;
  padding:3px 7px;
  border-radius:999px;
  background:#020617;
  color:var(--muted);
}

.card-selects{
  display:grid;
  grid-template-columns:repeat(3,minmax(0,1fr));
  gap:6px;
  margin-top:8px;
  font-size:.75rem;
}
.card-select{
  display:flex;
  flex-direction:column;
  gap:3px;
}
.card-select label{color:var(--muted);}
.card-select select{
  border-radius:999px;
  border:1px solid #1f2937;
  padding:4px 6px;
  background:#020617;
  color:#e5e7eb;
  font-size:.8rem;
  outline:none;
}

/* Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© */
.info-row{
  margin-top:6px;
  display:flex;
  flex-direction:column;
  gap:2px;
}
.info-line{
  font-size:.75rem;
  color:var(--muted);
}

/* Ø§Ù„Ù†Ø³Ø¨ */
.progress-row{
  display:grid;
  grid-template-columns:repeat(2,minmax(0,1fr));
  gap:8px;
  margin-top:8px;
}
.progress-block{
  display:flex;
  flex-direction:column;
  gap:3px;
}
.progress-label{
  display:flex;
  justify-content:space-between;
  font-size:.75rem;
  color:var(--muted);
}
.progress-value{font-weight:600;}
.progress-bar{
  width:100%;
  height:6px;
  border-radius:999px;
  background:#020617;
  overflow:hidden;
}
.progress-fill{
  height:100%;
  width:0%;
  border-radius:999px;
  transition:width .25s ease;
}
.fill-good{background:var(--good);}
.fill-mid{background:var(--mid);}
.fill-bad{background:var(--bad);}

/* ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± */
.parent-container{
  max-width:900px;
  margin:16px auto;
  padding:14px;
  border-radius:16px;
  background:#0f172a;
  border:1px solid #111827;
}
.parent-header-box{
  display:flex;
  align-items:center;
  gap:12px;
  margin-bottom:10px;
}
.parent-id-card{
  width:70px;
  height:45px;
  border-radius:8px;
  border:2px solid var(--accent);
  background:#020617;
}
.parent-name{font-size:1rem;font-weight:600;}
.parent-id-text{font-size:.8rem;color:var(--muted);}

.parent-week{
  margin:8px 0 10px;
  font-size:.9rem;
}
.parent-week select{
  padding:4px 10px;
  border-radius:999px;
  border:1px solid #1f2937;
  background:#020617;
  color:#e5e7eb;
}
.parent-days{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:10px;
}
.parent-day-card{
  background:#020617;
  border-radius:12px;
  padding:8px 10px;
  border:1px solid #1f2937;
  font-size:.8rem;
}
.parent-day-title{font-weight:700;margin-bottom:4px;}
.parent-summary{
  margin-top:12px;
  font-size:.9rem;
}
.parent-bar{
  width:100%;
  height:8px;
  border-radius:999px;
  background:#020617;
  overflow:hidden;
  margin-top:4px;
}
.parent-bar-fill{
  height:100%;
  width:0%;
  border-radius:999px;
  background:var(--accent);
  transition:width .25s ease;
}
</style>
</head>
<body>

<!-- ØµÙØ­Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<div id="loginPage" class="page active">
  <div class="login-wrapper">
    <div class="login-card">
      <h1>Ø­Ù„Ù‚Ø© Ø§Ù„Ù…Ù„Ùƒ ÙÙ‡Ø¯</h1>
      <p>Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© Ù„Ù„Ù…Ø¹Ù„Ù… Ø£Ùˆ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±</p>
      <input id="identityInput" class="login-input" type="number" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©">
      <button class="btn btn-primary" id="loginBtn">Ø¯Ø®ÙˆÙ„</button>
      <div id="loginError" class="login-error"></div>
      <!-- ØªÙ… Ø­Ø°Ù ØªÙ„Ù…ÙŠØ­ Ø±Ù‚Ù… Ù‡ÙˆÙŠØ© Ø§Ù„Ù…Ø¹Ù„Ù… Ø­ØªÙ‰ Ù…Ø§ ÙŠØ·Ù„Ø¹ -->
    </div>
  </div>
</div>

<!-- ØµÙØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù… -->
<div id="teacherPage" class="page">
  <header class="app-header">
    <h2>ğŸ“˜ Ø­Ù„Ù‚Ø© Ø§Ù„Ù…Ù„Ùƒ ÙÙ‡Ø¯ â€“ Ø§Ù„Ù…Ø¹Ù„Ù…</h2>
    <div style="display:flex;gap:8px;align-items:center;">
      <div class="badge">ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¹Ù„Ù…</div>
      <button class="btn btn-secondary" onclick="goToLogin()">Ø®Ø±ÙˆØ¬</button>
    </div>
  </header>

  <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ (B) -->
  <div class="top-controls">
    <div class="top-left">
      <div class="select-pill">
        <label>Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</label>
        <select id="weekSelect"></select>
      </div>
      <div class="select-pill">
        <label>Ø§Ù„ÙŠÙˆÙ…</label>
        <select id="daySelect">
          <option value="Ø§Ù„Ø£Ø­Ø¯">Ø§Ù„Ø£Ø­Ø¯</option>
          <option value="Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†">Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†</option>
          <option value="Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡">Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</option>
          <option value="Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡">Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</option>
        </select>
      </div>
    </div>

    <div class="top-right">
      <button class="btn btn-primary" id="saveBtn">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ÙŠÙˆÙ…</button>
      <button class="btn btn-secondary" id="loadBtn">ğŸ“‚ ØªØ­Ø¯ÙŠØ«</button>
      <button class="btn btn-secondary" id="resetBtn">â™» Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ÙŠÙˆÙ…</button>
    </div>
  </div>

  <main class="app-main">
    <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© -->
    <section class="settings-card">
      <div class="settings-group">
        <span>Ø§Ù„Ø­ÙØ¸:</span>
        <select id="hifzSelect"></select>
        <span>Ù…Ù† Ø¢ÙŠØ©</span>
        <select id="fromAyah"></select>
        <span>Ø¥Ù„Ù‰ Ø¢ÙŠØ©</span>
        <select id="toAyah"></select>
      </div>

      <div class="settings-group">
        <span>Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©:</span>
        <span>Ù…Ù† Ø³ÙˆØ±Ø©</span>
        <select id="murajaFrom"></select>
        <span>Ø¥Ù„Ù‰ Ø³ÙˆØ±Ø©</span>
        <select id="murajaTo"></select>
      </div>
    </section>

    <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ø´Ø±Ù -->
    <section class="honor-card">
      <h3>ğŸ† Ù„ÙˆØ­Ø© Ø§Ù„Ø´Ø±Ù Ù„Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</h3>
      <div id="honorList" class="honor-list">
        <div style="font-size:.85rem;color:var(--muted);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø¨Ø¹Ø¯.</div>
      </div>
    </section>

    <!-- ÙƒØ±ÙˆØª Ø§Ù„Ø·Ù„Ø§Ø¨ -->
    <section class="students-grid" id="studentsGrid"></section>
  </main>
</div>

<!-- ØµÙØ­Ø© ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± -->
<div id="parentPage" class="page">
  <header class="app-header">
    <h2>ğŸ“— ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø·Ø§Ù„Ø¨ â€“ Ø­Ù„Ù‚Ø© Ø§Ù„Ù…Ù„Ùƒ ÙÙ‡Ø¯</h2>
    <button class="btn btn-secondary" onclick="goToLogin()">Ø±Ø¬ÙˆØ¹</button>
  </header>

  <div class="parent-container">
    <div class="parent-header-box">
      <div class="parent-id-card"></div>
      <div>
        <div id="parentStudentName" class="parent-name"></div>
        <div id="parentStudentId" class="parent-id-text"></div>
      </div>
    </div>

    <div class="parent-week">
      <span>Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹:</span>
      <select id="parentWeekSelect"></select>
    </div>

    <div id="parentDaysGrid" class="parent-days"></div>

    <div class="parent-summary">
      Ù…ØªÙˆØ³Ø· Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹:
      <span id="parentWeeklyAvg" style="font-weight:600;">â€”</span>
    </div>
    <div class="parent-bar">
      <div id="parentBarFill" class="parent-bar-fill"></div>
    </div>
  </div>
</div>

<script>
// ===== Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ© =====
const TEACHER_ID = "1134561115";

const STUDENTS = [
  {id:1187268626,name:"Ø³Ù„ÙŠÙ…Ø§Ù† Ø¨Ø¯Ø± Ø§Ù„Ø¨Ø¯Ø±"},
  {id:1189227745,name:"Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ ØªØ±ÙƒÙŠ Ø§Ù„ÙØ±Ù‡ÙˆØ¯"},
  {id:2205054398,name:"Ø¹Ù…Ø± Ø£Ø­Ù…Ø¯ Ø§Ù„Ø¬Ø§Ù…ÙˆØ³"},
  {id:1189999459,name:"Ø³Ù„ÙŠÙ…Ø§Ù† Ù…Ø­Ù…Ø¯ Ø§Ù„ÙØ±Ø§Ø¬"},
  {id:1185278643,name:"Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ù…Ø´Ø¹Ù„ Ø§Ù„Ø²Ù†ÙŠØ¯ÙŠ"},
  {id:1185278551,name:"ÙÙ‡Ø¯ Ù…Ø´Ø¹Ù„ Ø§Ù„Ø²Ù†ÙŠØ¯ÙŠ"},
  {id:1188591612,name:"Ù…Ø­Ù…Ø¯ Ø¨Ø¯Ø± Ø§Ù„Ø¯Ø¨Ù„Ø§Ù†"},
  {id:1189187329,name:"Ø¢Ø³Ø± Ø¨Ø¯Ø± Ø§Ù„Ù†Ø§ØµØ±"},
  {id:1187846504,name:"Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ø§Ù„Ø¯Ø¨Ù„Ø§Ù†"},
  {id:1189208240,name:"Ø¹Ù…Ø± ÙÙ‡Ø¯ Ø§Ù„Ø¯Ø¨Ù„Ø§Ù†"},
  {id:1189368226,name:"Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ø­Ù…Ø¯Ø§Ù† Ø§Ù„Ø¨Ø§ØªÙ„"},
  {id:2165181212,name:"Ø¹Ø¨Ø¯Ø§Ù„ÙƒØ±ÙŠÙ… Ø³Ù„Ù…Ø§Ù† Ø§Ù„Ø­Ù…ÙˆØ¯"},
  {id:1189958752,name:"Ø£Ø­Ù…Ø¯ Ø³Ø¹ÙˆØ¯ Ø§Ù„Ù…Ù†ÙŠØ¹"},
  {id:1188880486,name:"Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ ÙÙ‡Ø¯ Ø§Ù„Ø·ÙˆØ§Ù„Ù‡"},
  {id:2130169358,name:"Ø¥ÙŠØ§Ø¯ Ø£Ø­Ù…Ø¯ Ø§Ù„Ù†Ø¬Ø§Ø´ÙŠ"},
  {id:2207344761,name:"Ù…Ø­Ù…Ø¯ Ø­Ù…Ø¯ Ø§Ù„Ø¹Ø³Ø§Ù"}
];
const NUM = STUDENTS.length;

const DAYS = ["Ø§Ù„Ø£Ø­Ø¯","Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†","Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡","Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡"];

const STORAGE_PREFIX = "halqat_malik_fahd_v3";

// Ù‚ÙŠÙ… Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
const tasmee3Values = { "Ù…Ù…ØªØ§Ø²":100, "Ø¬ÙŠØ¯":70, "Ù„Ù… ÙŠØ­ÙØ¸":0 };
const adabValues    = { "Ù…Ø¤Ø¯Ø¨":100, "Ù…Ø´Ø§ØºØ¨":0 };
const hodoorValues  = { "Ø­Ø§Ø¶Ø±":100, "Ù…ØªØ£Ø®Ø±":70, "ØºØ§Ø¦Ø¨ Ø¨Ø¹Ø°Ø±":0, "ØºØ§Ø¦Ø¨ Ø¨Ø¯ÙˆÙ† Ø¹Ø°Ø±":0 };

// Ø³ÙˆØ± Ø¬Ø²Ø¡ Ø¹Ù… + Ø¹Ø¯Ø¯ Ø§Ù„Ø¢ÙŠØ§Øª
const surasInfo = {
  "Ø§Ù„Ù†Ø§Ø³":6,"Ø§Ù„ÙÙ„Ù‚":5,"Ø§Ù„Ø¥Ø®Ù„Ø§Øµ":4,"Ø§Ù„Ù…Ø³Ø¯":5,"Ø§Ù„Ù†ØµØ±":3,"Ø§Ù„ÙƒØ§ÙØ±ÙˆÙ†":6,"Ø§Ù„ÙƒÙˆØ«Ø±":3,"Ø§Ù„Ù…Ø§Ø¹ÙˆÙ†":7,
  "Ù‚Ø±ÙŠØ´":4,"Ø§Ù„ÙÙŠÙ„":5,"Ø§Ù„Ù‡Ù…Ø²Ø©":9,"Ø§Ù„Ø¹ØµØ±":3,"Ø§Ù„ØªÙƒØ§Ø«Ø±":8,"Ø§Ù„Ù‚Ø§Ø±Ø¹Ø©":11,"Ø§Ù„Ø¹Ø§Ø¯ÙŠØ§Øª":11,"Ø§Ù„ØªÙŠÙ†":8,
  "Ø§Ù„Ø´Ø±Ø­":8,"Ø§Ù„Ø¶Ø­Ù‰":11,"Ø§Ù„Ù„ÙŠÙ„":21,"Ø§Ù„Ø´Ù…Ø³":15,"Ø§Ù„Ø¨Ù„Ø¯":20,"Ø§Ù„ÙØ¬Ø±":30,"Ø§Ù„ØºØ§Ø´ÙŠØ©":26,"Ø§Ù„Ø£Ø¹Ù„Ù‰":19,
  "Ø§Ù„Ø·Ø§Ø±Ù‚":17,"Ø§Ù„Ø¨Ø±ÙˆØ¬":22,"Ø§Ù„Ø§Ù†Ø´Ù‚Ø§Ù‚":25,"Ø§Ù„Ù…Ø·ÙÙÙŠÙ†":36,"Ø§Ù„Ø§Ù†ÙØ·Ø§Ø±":19,"Ø§Ù„ØªÙƒÙˆÙŠØ±":29,"Ø¹Ø¨Ø³":42,
  "Ø§Ù„Ù†Ø§Ø²Ø¹Ø§Øª":46,"Ø§Ù„Ù†Ø¨Ø£":40,"Ø§Ù„Ù…Ø±Ø³Ù„Ø§Øª":50
};

// ===== Ø£Ø¯ÙˆØ§Øª Ø¹Ø§Ù…Ø© =====
function showPage(id){
  document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}
function goToLogin(){ showPage("loginPage"); }

// Ù…ÙØªØ§Ø­ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ù„Ù„Ø£Ø³Ø¨ÙˆØ¹
function weekKey(week){ return STORAGE_PREFIX + "week" + week; }

// Ø­Ø³Ø§Ø¨ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© (ØªØ³Ù…ÙŠØ¹ + Ø£Ø¯Ø¨ + Ø­Ø¶ÙˆØ±)
// - ØºÙŠØ§Ø¨ = 0 Ù…Ø­Ø³ÙˆØ¨
// - ÙØ§Ø¶ÙŠ (ÙˆÙ„Ø§ Ø§Ø®ØªÙŠØ§Ø±) = null (Ù…Ø§ ÙŠØ¯Ø®Ù„ Ø¨Ø§Ù„Ø­Ø³Ø§Ø¨)
function computeDaily(rec){
  if(!rec) return null;
  const isAbsent = rec.hodoor && rec.hodoor.includes("ØºØ§Ø¦Ø¨");
  if(isAbsent) return 0;

  let sum=0, c=0;
  if(rec.tasmee3){ sum+=tasmee3Values[rec.tasmee3]||0; c++; }
  if(rec.adab){    sum+=adabValues[rec.adab]||0;       c++; }
  if(rec.hodoor){  sum+=hodoorValues[rec.hodoor]||0;   c++; }
  if(c===0) return null;
  return +(sum/c).toFixed(1);
}

// Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠ: Ù…Ù† Ø£ÙˆÙ„ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø¥Ù„Ù‰ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ (Ø£Ø¯Ø¨ + Ø­Ø¶ÙˆØ± ÙÙ‚Ø·)
function computeCumulative(weekData,studentIndex,dayIndex){
  let total=0, count=0;
  for(let d=0; d<=dayIndex; d++){
    const dayName = DAYS[d];
    const dayRecords = weekData[dayName];
    if(!dayRecords) continue;
    const rec = dayRecords[studentIndex];
    if(!rec) continue;

    const isAbsent = rec.hodoor && rec.hodoor.includes("ØºØ§Ø¦Ø¨");
    if(isAbsent){
      total += 0;
      count++;
      continue;
    }

    let sum=0, c=0;
    if(rec.adab){    sum += adabValues[rec.adab];    c++; }
    if(rec.hodoor){  sum += hodoorValues[rec.hodoor];c++; }
    if(c===0) continue;

    const dayScore = sum / c;
    total += dayScore;
    count++;
  }
  if(count===0) return null;
  return +(total/count).toFixed(1);
}

// Ù…ØªÙˆØ³Ø· Ø£Ø³Ø¨ÙˆØ¹ ÙƒØ§Ù…Ù„ (Ù„ÙˆØ­Ø© Ø§Ù„Ø´Ø±Ù + ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±)
function computeWeeklyAvg(weekData,studentIndex){
  let total=0, count=0;
  for(const dayName of DAYS){
    const recs = weekData[dayName];
    if(!recs) continue;
    const rec = recs[studentIndex];
    const d = computeDaily(rec);
    if(d===null) continue;
    total += d;
    count++;
  }
  if(count===0) return null;
  return +(total/count).toFixed(1);
}

// ØªØµÙ†ÙŠÙ Ù„ÙˆÙ† Ø§Ù„Ø¨Ø§Ø±
function classForValue(v){
  if(v>=90) return "fill-good";
  if(v>=60) return "fill-mid";
  return "fill-bad";
}

// ===== Ø¹Ù†Ø§ØµØ± DOM =====
const loginPage = document.getElementById("loginPage");
const teacherPage = document.getElementById("teacherPage");
const parentPage  = document.getElementById("parentPage");

const identityInput = document.getElementById("identityInput");
const loginBtn = document.getElementById("loginBtn");
const loginError = document.getElementById("loginError");

const weekSelect = document.getElementById("weekSelect");
const daySelect  = document.getElementById("daySelect");
const studentsGrid = document.getElementById("studentsGrid");
const honorList = document.getElementById("honorList");

const hifzSelect = document.getElementById("hifzSelect");
const fromAyah   = document.getElementById("fromAyah");
const toAyah     = document.getElementById("toAyah");
const murajaFrom = document.getElementById("murajaFrom");
const murajaTo   = document.getElementById("murajaTo");

const saveBtn  = document.getElementById("saveBtn");
const loadBtn  = document.getElementById("loadBtn");
const resetBtn = document.getElementById("resetBtn");

// ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±
const parentStudentName = document.getElementById("parentStudentName");
const parentStudentId   = document.getElementById("parentStudentId");
const parentWeekSelect  = document.getElementById("parentWeekSelect");
const parentDaysGrid    = document.getElementById("parentDaysGrid");
const parentWeeklyAvg   = document.getElementById("parentWeeklyAvg");
const parentBarFill     = document.getElementById("parentBarFill");

// ===== ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ =====
function handleLogin(){
  const val = identityInput.value.trim();
  if(!val){
    loginError.textContent="Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©";
    return;
  }
  // Ø§Ù„Ù…Ø¹Ù„Ù…
  if(val === TEACHER_ID){
    loginError.textContent="";
    showPage("teacherPage");
    loadTeacherInitial();
    return;
  }
  // Ø§Ù„Ø·Ø§Ù„Ø¨
  const idx = STUDENTS.findIndex(s => String(s.id) === val);
  if(idx === -1){
    loginError.textContent="Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© ØºÙŠØ± Ù…Ø³Ø¬Ù„";
    return;
  }
  loginError.textContent="";
  localStorage.setItem("currentStudentIndex",String(idx));
  showPage("parentPage");
  loadParentInitial();
}
loginBtn.addEventListener("click",handleLogin);
identityInput.addEventListener("keydown",e=>{
  if(e.key==="Enter") handleLogin();
});

// ===== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… =====
function initSelects(){
  // Ø£Ø³Ø§Ø¨ÙŠØ¹
  for(let i=1;i<=16;i++){
    const o1=document.createElement("option");
    o1.value=i;o1.textContent=i;
    weekSelect.appendChild(o1);

    const o2=document.createElement("option");
    o2.value=i;o2.textContent=i;
    parentWeekSelect.appendChild(o2);
  }
  weekSelect.value="1";
  parentWeekSelect.value="1";

  // Ø³ÙˆØ±
  Object.keys(surasInfo).forEach(s=>{
    let o1=document.createElement("option");
    o1.value=s;o1.textContent=s;
    hifzSelect.appendChild(o1);

    let o2=document.createElement("option");
    o2.value=s;o2.textContent=s;
    murajaFrom.appendChild(o2);

    let o3=document.createElement("option");
    o3.value=s;o3.textContent=s;
    murajaTo.appendChild(o3);
  });

  // Ø¢ÙŠØ§Øª Ø­Ø³Ø¨ Ø§Ù„Ø³ÙˆØ±Ø©
  function fillAyat(){
    fromAyah.innerHTML="";
    toAyah.innerHTML="";
    const max = surasInfo[hifzSelect.value] || 6;
    for(let i=1;i<=max;i++){
      let o1=document.createElement("option");
      o1.value=i;o1.textContent=i;
      fromAyah.appendChild(o1);

      let o2=document.createElement("option");
      o2.value=i;o2.textContent=i;
      toAyah.appendChild(o2);
    }
  }
  hifzSelect.addEventListener("change",()=>{fillAyat(); loadCurrentTeacher();});
  fillAyat();
}

// ===== Ø¨Ù†Ø§Ø¡ ÙƒØ±Øª Ø·Ø§Ù„Ø¨ Ù„Ù„Ù…Ø¹Ù„Ù… =====
function createStudentCard(i,dayRec,weekData,dayIndex){
  const card=document.createElement("div");
  card.className="student-card";

  card.innerHTML=`
    <div class="card-header">
      <div class="card-header-left">
        <div class="avatar">${i+1}</div>
        <div>
          <div class="name">${STUDENTS[i].name}</div>
          <div class="card-tag">Ø·Ø§Ù„Ø¨ Ø±Ù‚Ù… ${i+1}</div>
        </div>
      </div>
      <div class="card-tag">${daySelect.value}</div>
    </div>

    <div class="card-selects">
      <div class="card-select">
        <label>Ø§Ù„ØªØ³Ù…ÙŠØ¹</label>
        <select class="tasmee3">
          <option value=""></option>
          <option value="Ù…Ù…ØªØ§Ø²">Ù…Ù…ØªØ§Ø²</option>
          <option value="Ø¬ÙŠØ¯">Ø¬ÙŠØ¯</option>
          <option value="Ù„Ù… ÙŠØ­ÙØ¸">Ù„Ù… ÙŠØ­ÙØ¸</option>
        </select>
      </div>
      <div class="card-select">
        <label>Ø§Ù„Ø£Ø¯Ø¨</label>
        <select class="adab">
          <option value=""></option>
          <option value="Ù…Ø¤Ø¯Ø¨">Ù…Ø¤Ø¯Ø¨</option>
          <option value="Ù…Ø´Ø§ØºØ¨">Ù…Ø´Ø§ØºØ¨</option>
        </select>
      </div>
      <div class="card-select">
        <label>Ø§Ù„Ø­Ø¶ÙˆØ±</label>
        <select class="hodoor">
          <option value=""></option>
          <option value="Ø­Ø§Ø¶Ø±">Ø­Ø§Ø¶Ø±</option>
          <option value="Ù…ØªØ£Ø®Ø±">Ù…ØªØ£Ø®Ø±</option>
          <option value="ØºØ§Ø¦Ø¨ Ø¨Ø¹Ø°Ø±">ØºØ§Ø¦Ø¨ Ø¨Ø¹Ø°Ø±</option>
          <option value="ØºØ§Ø¦Ø¨ Ø¨Ø¯ÙˆÙ† Ø¹Ø°Ø±">ØºØ§Ø¦Ø¨ Ø¨Ø¯ÙˆÙ† Ø¹Ø°Ø±</option>
        </select>
      </div>
    </div>

    <div class="info-row">
      <div class="info-line hifzLine"></div>
      <div class="info-line murajaLine"></div>
    </div>

    <div class="progress-row">
      <div class="progress-block">
        <div class="progress-label">
          <span>Ø§Ù„ÙŠÙˆÙ…ÙŠ</span>
          <span class="progress-value dailyVal">â€”</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill dailyFill"></div>
        </div>
      </div>
      <div class="progress-block">
        <div class="progress-label">
          <span>Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠ</span>
          <span class="progress-value totalVal">â€”</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill totalFill"></div>
        </div>
      </div>
    </div>
  `;

  // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù‚ÙŠÙ…
  const tasSel=card.querySelector(".tasmee3");
  const adabSel=card.querySelector(".adab");
  const hodSel=card.querySelector(".hodoor");

  tasSel.value=dayRec?.tasmee3 || "";
  adabSel.value=dayRec?.adab || "";
  hodSel.value=dayRec?.hodoor || "";

  // Ù†Øµ Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©
  card.querySelector(".hifzLine").textContent =
    Ø§Ù„Ø­ÙØ¸: ${hifzSelect.value} (${fromAyah.value} - ${toAyah.value});
  card.querySelector(".murajaLine").textContent =
    Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©: Ù…Ù† ${murajaFrom.value} Ø¥Ù„Ù‰ ${murajaTo.value};

  // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙŠÙˆÙ…ÙŠ + Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠ
  updateCardProgress(card,weekData,i,dayIndex);

  // Ù„Ùˆ ØºØ§Ø¦Ø¨
  if(hodSel.value.includes("ØºØ§Ø¦Ø¨")){
    card.classList.add("absent");
  }else{
    card.classList.remove("absent");
  }

  // Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø£ÙŠ Ø§Ø®ØªÙŠØ§Ø± â†’ Ø­ÙØ¸ ÙˆØªØ­Ø¯ÙŠØ«
  card.querySelectorAll("select").forEach(sel=>{
    sel.addEventListener("change",()=>{
      saveCurrentDay();
    });
  });

  return card;
}

function updateCardProgress(card,weekData,i,dayIndex){
  const tas = card.querySelector(".tasmee3").value;
  const adab= card.querySelector(".adab").value;
  const hod = card.querySelector(".hodoor").value;

  const dailyVal  = card.querySelector(".dailyVal");
  const dailyFill = card.querySelector(".dailyFill");
  const totalVal  = card.querySelector(".totalVal");
  const totalFill = card.querySelector(".totalFill");

  const isAbsent = hod.includes("ØºØ§Ø¦Ø¨");

  // Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
  const recToday = {tasmee3:tas,adab,hodoor:hod};
  const d = computeDaily(recToday);
  if(d===null){
    if(isAbsent){
      dailyVal.textContent="0%";
      dailyFill.style.width="0%";
      dailyFill.className="progress-fill fill-bad";
    }else{
      dailyVal.textContent="â€”";
      dailyFill.style.width="0%";
      dailyFill.className="progress-fill";
    }
  }else{
    dailyVal.textContent = d+"%";
    dailyFill.style.width = d+"%";
    dailyFill.className = "progress-fill " + classForValue(d);
  }

  // Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠ
  const t = computeCumulative(weekData,i,dayIndex);
  if(t===null){
    totalVal.textContent="â€”";
    totalFill.style.width="0%";
    totalFill.className="progress-fill";
  }else{
    totalVal.textContent=t+"%";
    totalFill.style.width=t+"%";
    totalFill.className="progress-fill " + classForValue(t);
  }
}

// ===== ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù… =====
function loadCurrentTeacher(){
  const k = weekKey(weekSelect.value);
  const weekData = JSON.parse(localStorage.getItem(k)||"{}");
  const today = daySelect.value;
  const dayData = weekData[today] || [];
  const dayIndex = DAYS.indexOf(today);

  studentsGrid.innerHTML="";
  for(let i=0;i<NUM;i++){
    studentsGrid.appendChild(
      createStudentCard(i,dayData[i]||{},weekData,dayIndex)
    );
  }
  updateHonorBoard(weekData);
}

function saveCurrentDay(){
  const k = weekKey(weekSelect.value);
  let weekData = JSON.parse(localStorage.getItem(k)||"{}");
  const today = daySelect.value;

  const data = Array.from(studentsGrid.querySelectorAll(".student-card")).map(card=>({
    tasmee3:card.querySelector(".tasmee3").value,
    adab:card.querySelector(".adab").value,
    hodoor:card.querySelector(".hodoor").value
  }));

  weekData[today] = data;
  localStorage.setItem(k,JSON.stringify(weekData));
  loadCurrentTeacher();
}

function resetCurrentDay(){
  if(!confirm("Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¨ÙŠØ§Ù†Ø§Øª Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…ØŸ")) return;
  const k = weekKey(weekSelect.value);
  let weekData = JSON.parse(localStorage.getItem(k)||"{}");
  weekData[daySelect.value] = [];
  localStorage.setItem(k,JSON.stringify(weekData));
  loadCurrentTeacher();
}

// Ù„ÙˆØ­Ø© Ø§Ù„Ø´Ø±Ù (Ø£Ø³Ø¨ÙˆØ¹ ÙƒØ§Ù…Ù„)
function updateHonorBoard(weekData){
  let list=[];
  for(let i=0;i<NUM;i++){
    const avg = computeWeeklyAvg(weekData,i);
    if(avg===null) continue; // Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹
    list.push({i,avg});
  }

  if(list.length===0){
    honorList.innerHTML = <div style="font-size:.85rem;color:var(--muted);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø¨Ø¹Ø¯.</div>;
    return;
  }

  list.sort((a,b)=>b.avg-a.avg);
  const top = list.slice(0,3);
  const firstScore = top[0].avg;

  let html="";
  top.forEach((s,idx)=>{
    let rank="";
    if(idx===0){
      rank="Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø£ÙˆÙ„ ğŸ¥‡";
    }else if(s.avg===firstScore){
      rank="Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø£ÙˆÙ„ (Ù…ÙƒØ±Ø±) ğŸ¥‡";
    }else if(idx===1){
      rank="Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø«Ø§Ù†ÙŠ ğŸ¥ˆ";
    }else{
      rank="Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø«Ø§Ù„Ø« ğŸ¥‰";
    }
    html += `
      <div class="honor-item">
        <div class="honor-rank">${rank}</div>
        <div class="honor-name">${STUDENTS[s.i].name}</div>
        <div style="font-weight:600;">${s.avg}%</div>
      </div>
    `;
  });

  honorList.innerHTML = html;
}

// ===== ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± =====
function loadParentInitial(){
  const idxStr = localStorage.getItem("currentStudentIndex");
  if(idxStr===null){
    goToLogin();
    return;
  }
  const idx = parseInt(idxStr,10);
  const st = STUDENTS[idx];

  parentStudentName.textContent = st.name;
  parentStudentId.textContent   = "Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©: " + st.id;

  renderParent();
}

function renderParent(){
  const idx = parseInt(localStorage.getItem("currentStudentIndex")||"0",10);
  const k = weekKey(parentWeekSelect.value);
  const weekData = JSON.parse(localStorage.getItem(k)||"{}");

  parentDaysGrid.innerHTML="";
  let total=0,count=0;

  DAYS.forEach(day=>{
    const recs = weekData[day];
    const rec = recs ? recs[idx] : undefined;
    const d = computeDaily(rec);

    let dailyText="â€”";
    let color="var(--muted)";
    if(d===null){
      if(rec && rec.hodoor && rec.hodoor.includes("ØºØ§Ø¦Ø¨")){
        dailyText="0%";
        color="var(--bad)";
        total+=0;count++;
      }else{
        dailyText="Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ÙŠÙˆÙ…";
      }
    }else{
      dailyText=d+"%";
      total+=d;count++;
      if(d>=90) color="var(--good)";
      else if(d>=60) color="var(--mid)";
      else color="var(--bad)";
    }

    parentDaysGrid.innerHTML += `
      <div class="parent-day-card">
        <div class="parent-day-title">${day}</div>
        <div>ğŸ¤ Ø§Ù„ØªØ³Ù…ÙŠØ¹: ${rec?.tasmee3 || "-"}</div>
        <div>ğŸ™ Ø§Ù„Ø£Ø¯Ø¨: ${rec?.adab || "-"}</div>
        <div>ğŸš¶â€â™‚ Ø§Ù„Ø­Ø¶ÙˆØ±: ${rec?.hodoor || "-"}</div>
        <div style="margin-top:6px;font-weight:600;color:${color};">
          Ù†Ø³Ø¨Ø© Ø§Ù„ÙŠÙˆÙ…: ${dailyText}
        </div>
      </div>
    `;
  });

  if(count===0){
    parentWeeklyAvg.textContent="Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹";
    parentBarFill.style.width="0%";
  }else{
    const avg = +(total/count).toFixed(1);
    parentWeeklyAvg.textContent=avg+"%";
    parentBarFill.style.width=avg+"%";
  }
}

// ===== ØªØ­Ù…ÙŠÙ„ Ø£ÙˆÙ„ÙŠ =====
function loadTeacherInitial(){
  loadCurrentTeacher();
}

weekSelect.addEventListener("change",loadCurrentTeacher);
daySelect.addEventListener("change",loadCurrentTeacher);
[murajaFrom,murajaTo,fromAyah,toAyah].forEach(el=>{
  el.addEventListener("change",loadCurrentTeacher);
});

saveBtn.addEventListener("click",()=>{
  saveCurrentDay();
  alert("ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ… âœ…");
});
loadBtn.addEventListener("click",loadCurrentTeacher);
resetBtn.addEventListener("click",resetCurrentDay);

parentWeekSelect.addEventListener("change",renderParent);

// ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ÙŠ
initSelects();
</script>

</body>
</html>